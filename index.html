<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>GDA Finance – Local App</title>
<style>
body { font-family: Arial; padding: 20px; }
iframe#gas-frame { display:none; }
</style>
</head>
<body>

<h2>GDA Finance – Local (file://) mód</h2>

<form id="transactionForm">
  <label>Dátum: <input type="date" name="date" required></label><br><br>
  <label>Összeg: <input type="number" name="amount" step="0.01" required></label><br><br>
  <label>Jogcím: <input type="text" name="title" required></label><br><br>
  <button type="submit">Mentés</button>
</form>

<div id="result"></div>

<!-- HIDDEN IFRAME – a GAS backend kommunikációhoz -->
<iframe id="gas-frame"
        src="https://script.google.com/macros/s/AKfycbz7yR3FF8EJfNRCXbIbYlfRtdgEsBoBMl0mEJtt7el69bMPNJWbcaFgqaWXxaq3nvg/exec"
        ></iframe>

<script>
// Parent → Iframe kommunikáció (local file:// alatt MŰKÖDIK)
const iframe = document.getElementById("gas-frame").contentWindow;

// Fogadjuk a GAS-ből visszajövő üzeneteket
window.addEventListener("message", (event) => {
    document.getElementById("result").innerText = "Válasz: " + event.data;
});

// Form küldése postMessage-en keresztül
document.getElementById("transactionForm").addEventListener("submit", function(e){
    e.preventDefault();

    const formData = new FormData(e.target);
    formData.append("action", "save_transaction");

    // Form-data objektum sima JS objektummá alakítása
    const payload = {};
    formData.forEach((v,k)=>payload[k]=v);

    iframe.postMessage(payload, "*");
});
</script>

</body>
</html>
